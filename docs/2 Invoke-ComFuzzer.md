# Phase 2 - Fuzzing

This phase focusus on fuzzing the specified COM targets parsed with `ComServerData.json`, which was exported by `Get-ComServerData`.

## Usage
```
NAME
    Invoke-ComFuzzer

SYNTAX
    Invoke-ComFuzzer [-ComDataFile] <String> [[-minStrLen] <Int32>] [[-maxStrLen] <Int32>] [[-StringInput] <String>]
    [[-minIntSize] <Int32>] [[-maxIntSize] <Int32>] [[-GuidInput] <Guid>] [[-IntInput] <Int32>] [[-UNC] <String>]
    [-OutPath] <String> [-NoSpecialChars] [[-Blacklist] <String>] [[-Procedure] <String>] [[-Iterations] <Int32>]
    [[-Canary] <String>] [[-RemoteServer] <String>] [[-Username] <String>] [[-Password] <String>] [[-Domain] <String>]
    [[-Skip] <String[]>] [[-Timeout] <Int32>] [<CommonParameters>]

OPTIONS
    -Output
    -ComDataFile
    -Iterations             Number of iterations to generate random input for a specific COM call and invoke it (default 1)
    -UNC                    Specify a IPv4 address for UNC path. Test for NTLM-relay attack vectors.
    -Canary                 A unique string to trace COM calls back (can be applied as filter in ProcMon)
    -OutPath                Path to export fuzzing data to
    -StringInput            Parse your own value for string parameters (for example a existing file)
    -NoSpecialChars         Do not include special characters in random strings (prevent NAME INVALID)
    -intInput               Parse your own int32 value for integer values
    -guidInput              Parse your own guid value for guid values
    -minStrLen              The minimal length for a string when generating fuzz data (default 5)
    -maxStrLen              The maximal length for a string when generating fuzz data (default 20)
    -minIntSize             The minimal integer size when generating fuzz data (default 10)
    -maxIntSize             The maixmal integer size when generating fuzz data (default 100)
    -minByteArrLen          The minimal Byte Array length when generating fuzz data (default 100)
    -maxByteArrLen          The maximal Byte Array length when generating fuzz data (default 1000)
    -Procedure              Specify a specific procedure to fuzz
    -Blacklist              Specify blacklisted procedures (fuzzer will not invoke these procedures)
    -RemoteServer           Specify the IPv4 address of the remote COM server
    -Username               Specify the username for authentication to the remote COM server
    -Password               Specify the password for authentication to the remote COM server
    -Domain                 Specify the domain for authentication to the remote COM server
    -Skip                   Specify procedures to skip
    -Timeout                Specify timeout for hanging procedures (default 5 seconds)
```

## Examples
Parse the JSON file that was generated by `Get-ComServerData` to the cmdlet `Invoke-ComFuzzer`:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\
```

Specify your own string value. This can be useful to see what a COM procedure does with an existing file:

```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -StringInput "C:\Path\To\My\evil.dll"
```

Test for NTLM-relay attack vectors using a UNC path, only specify the IPv4:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -UNC 172.22.13.110
```

Specify length for Strings:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -minStrLen 100 -maxStrLen 200
```

Specify size for Integers:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -minIntSize 10 -maxIntSize 20
```

Fuzzing with a COM class blacklist:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -Blacklist ./blacklist.txt
```

Specify a specific procedure to fuzz with minimal and maximal string lengths:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -outpath .\output\ -Procedure Proc17 -minStrLen 100 -maxStrLen 1000
```

Specify your own integer and guid as parameters for fuzzing input:
```powershell
$myguid = New-Guid
PS '.\output\ComServerData.json' | Invoke-ComFuzzer -outpath .\output\ -Procedure Proc17 -intInput 1337 -guidInput $myguid
```

Sometimes, string input without special characters can help to get more results. For example when you see `NAME INVALID` within Process Monitor for `CreateFile` operations. To prevent this, we can use the `-NoSpecialChars` switch:

```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -NoSpecialChars
```

Initialize a COM client for a remote COM server:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -RemoteServer 192.168.10.10 -Username admin -password Password123 -domain test.local
```

Skip COM procedures:
```powershell
'.\output\ComServerData.json' | Invoke-ComFuzzer -OutPath .\output\ -Skip "Proc1","Proc2"
```